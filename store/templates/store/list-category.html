{% extends "./base.html" %}
{% load static %}
{% load humanize %}

{% block content %}

<style>
  
  .product-grid {
    display: grid;
    grid-template-columns: repeat(5, minmax(0, 1fr)); /* 5 sản phẩm / hàng */
    gap: 20px;
  }

  .product-card {
    background: #fff;
    border-radius: .5rem;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: transform .2s ease;
  }

  .product-card:hover {
    transform: translateY(-4px);
  }

  .product-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    display: block;
  }

  .product-card .card-body {
    padding: .9rem;
  }
  .product-card .btn {
  font-size: 13px;
  padding: 6px 10px;
  width: 100%;
}

.d-flex.gap-2>* {
  flex: 1;
}

  /* Responsive */
  @media(max-width:1200px){
    .product-grid { grid-template-columns: repeat(4, 1fr); }
  }
  @media(max-width:992px){
    .product-grid { grid-template-columns: repeat(3, 1fr); }
  }
  @media(max-width:768px){
    .product-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media(max-width:480px){
    .product-grid { grid-template-columns: repeat(1, 1fr); }
  }
</style>

<main>
  <div class="album py-5 bg-light" style="margin-top:30px;">
    <div class="container">

      <div class="pb-3 h5">{{ category.name|capfirst }}</div>
      <!-- BỘ LỌC THEO KHOẢNG GIÁ -->
<div class="filter-dropdown" style="display:inline-block; position:relative; margin-bottom:15px;">
  <!-- Nút Bộ lọc -->
  <button class="btn-filter" id="btnFilter">
    <i class="fa fa-filter"></i> Bộ lọc
  </button>

  <!-- Dropdown khoảng giá -->
  <div id="priceDropdown" class="price-dropdown" style="display:none; position:absolute; top:100%; left:0; background:#fff; border:1px solid #ccc; border-radius:8px; min-width:160px; z-index:100;">
    <a href="{% url 'filter-price-category' category.slug %}?min_price=0&max_price=5000000" class="price-range-option">Dưới 5 triệu</a>
    <a href="{% url 'filter-price-category' category.slug %}?min_price=5000000&max_price=10000000" class="price-range-option">5 – 10 triệu</a>
    <a href="{% url 'filter-price-category' category.slug %}?min_price=10000000&max_price=20000000" class="price-range-option">10 – 20 triệu</a>
    <a href="{% url 'filter-price-category' category.slug %}?min_price=20000000" class="price-range-option">Trên 20 triệu</a>
  </div>
</div>

<!-- CSS -->
<style>
/* Nút Bộ lọc xanh Samsung */
.btn-filter {
  display: inline-flex;
  align-items: center;
  padding: 6px 12px;
  border: 1px solid #0072CE;
  border-radius: 8px;
  background-color: #fff;
  color: #0072CE;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-filter i { margin-right: 6px; }
.btn-filter:hover {
  background-color: #0072CE;
  color: #fff;
  border-color: #0072CE;
}

/* Dropdown khoảng giá */
.price-dropdown { display:none; }
.price-range-option {
  display:block;
  padding:8px 12px;
  color:#0072CE;
  text-decoration:none;
}
.price-range-option:hover { background:#f0f0f0; }
</style>

<!-- JS -->
<script>
const btnFilter = document.getElementById('btnFilter');
const priceDropdown = document.getElementById('priceDropdown');

// Toggle dropdown khi click nút
btnFilter.addEventListener('click', function(e){
  e.stopPropagation();
  priceDropdown.style.display = priceDropdown.style.display === 'block' ? 'none' : 'block';
});

// Click ngoài dropdown → đóng
document.addEventListener('click', function(){
  priceDropdown.style.display = 'none';
});

// Click khoảng giá → reload sang filter-price-category view
document.querySelectorAll('.price-range-option').forEach(function(option){
  option.addEventListener('click', function(e){
    e.preventDefault();
    window.location.href = this.href;
  });
});
</script>



        <!-- THANH LỌC SẢN PHẨM -->
        <div class="sort">
  <span>Sắp xếp theo: </span>
    <a href="{% url 'sort-category' category.slug %}?type=bestseller" class="sort-link">Bán chạy</a> ·
    <a href="{% url 'sort-category' category.slug %}?type=new" class="sort-link">Mới</a> ·
  <div class="price-sort">
    <a href="#" id="price">Giá <span id="arrow">▾</span></a>
    <div id="dropdown" style="display:none;position:absolute;background:#fff;border:1px solid #ccc;">
<a href="{% url 'sort-category' category.slug %}?type=asc" class="price-option">Giá thấp - cao</a>
        <a href="{% url 'sort-category' category.slug %}?type=desc" class="price-option">Giá cao - thấp</a>

    </div>
  </div>
</div>

<style>
.sort-link, #price { color:black; text-decoration:none; cursor:pointer; }
.sort-link.active, #price.active { color:blue; }
.price-sort { position:relative; display:inline-block; }
.price-option { display:block; padding:5px 10px; color:black; text-decoration:none; white-space:nowrap; }
.price-option:hover { background:#f0f0f0; }
#arrow { display:inline-block; transition:0.2s; }
#arrow.up { transform:rotate(180deg); }
</style>

<script>
const links = document.querySelectorAll('.sort-link');
const price = document.getElementById('price');
const dropdown = document.getElementById('dropdown');
const arrow = document.getElementById('arrow');

// Click link ngoài dropdown
links.forEach(l => {
  l.onclick = e => {

    links.forEach(x => x.classList.remove('active'));
    price.classList.remove('active');
    l.classList.add('active');
    dropdown.style.display = 'none';
    arrow.classList.remove('up');
  };
});

// Click Giá để toggle dropdown
price.onclick = e => {
  e.preventDefault();
  const open = dropdown.style.display === 'block';
  dropdown.style.display = open ? 'none' : 'block';
  arrow.classList.toggle('up', !open);
};

// Chọn giá → Giá xanh, dropdown đóng, mũi tên quay lại
document.querySelectorAll('.price-option').forEach(o => {
  o.onclick = e => {

    links.forEach(x => x.classList.remove('active'));
    price.classList.add('active');
    dropdown.style.display = 'none';
    arrow.classList.remove('up');
  };
});

// Click ngoài đóng dropdown
document.addEventListener('click', e => {
  if (!price.contains(e.target) && !dropdown.contains(e.target)) {
    dropdown.style.display = 'none';
    arrow.classList.remove('up');
  }
});
</script>
<!-- HẾT THANH LỌC -->


        <br>
      <hr><br>

      <div class="product-grid">

        {% for product in products %}
        <div class="product-card">
  <a href="{{ product.get_absolute_url }}">
    <img src="{{ product.image.url }}" alt="{{ product.title }}">
  </a>

  <div class="card-body">
    <p class="card-text mb-2">
      <a class="text-info text-decoration-none"
         href="{{ product.get_absolute_url }}">
         {{ product.title }}
      </a>
    </p>

    <h5 class="mb-2">{{ product.price|intcomma }} VND</h5>

    <div class="d-flex gap-2">
      <button class="btn btn-primary btn-sm add-cart-btn" data-id="{{ product.id }}">
        <i class="fa-solid fa-cart-plus"></i> Thêm
      </button>

      <a class="btn btn-outline-primary btn-sm" href="{{ product.get_absolute_url }}">
        <i class="fa-solid fa-eye"></i> 
      </a>
    </div>
  </div>
</div>

        {% endfor %}

      </div>

    </div>
  </div>
</main>

{% endblock %}